-# @sidebar = 'execution'
- set_title "Jobs"

%table
  %thead
    %tr
      %th ID
      %th Label / start step
      %th Created
      %th Started
      %th Completed
      %th Worker
      %th History
      %th
      %th
  %tbody
    - @jobs.each do |job|
      %tr
        %td= "j#{job.id}"
        %td
          - label = job.label.blank? ? "job ##{job.id}" : job.label
          = link_to label, job
          %br
          %i= "(s#{job.step_id}) #{job.step.label}" unless job.step.nil?
        %td
          = my_datetime job.created_at
          %br
          %i= seconds_ago(Time.now - job.created_at)
        %td
          - if job.started_at.nil?
            ="-"
          - else
            = my_datetime job.started_at
            %br
            %i= seconds_ago(Time.now - job.started_at)
        %td
          - if job.completed_at.nil?
            ="-"
          - else
            = my_datetime job.completed_at
            %br
            %i= "took #{job.completed_at - job.created_at}s"
        %td
          =# link_to "w#{job.worker_id}", worker_path(job.worker_id) unless job.worker_id.nil?
          = job.worker
        %td
          - job.actions.order('id DESC').each do |action|
            %b
              = my_datetime action.created_at
            = " (s#{action.step.id}) #{action.step.label}" unless action.step.nil?
            %br
        %td
          = link_to 'destroy', job, :confirm => 'Are you sure?', :method => :delete
          %br
          = link_to 'reset', reset_job_path(job), :confirm => 'Are you sure?'
        %td
          = image_tag job.status_image_path

          