- map_class =  @run.completed_at.nil? ? 'autorefresh' : 'completed'
- status_label =  @run.completed_at.nil? ? 'still running' : 'completed'
%h1 Showing run r#{@run.id} started at step s#{@run.start_step.id}: #{@run.start_step.label}

%p#notice= notice

=# 12 rows available here
.row
  .span5
    %h3 Current status
    %p
      %b Created at:
      = @run.created_at
    %p
      %b Updated at:
      = @run.updated_at
    %p
      %b Completed at:
      = @run.completed_at
    %br


    - if @running_actions.empty?
      No running action
      %br
    - else
      %table
        %tr
          %th Action
          %th Step
          %th Created
          %th Updated
          %th Completed
        - @running_actions.each do |action|
          %tr
            %td= "a#{action.id}"
            %td= "s#{action.step.id} #{action.step.label}" 
            %td= my_datetime action.created_at
            %td= my_datetime action.updated_at
            %td= my_datetime action.completed_at

  .span4
    FOUR

%h3= "Status map for this run (#{status_label})"
= image_tag run_graph_path, :class => map_class

%h3 Variables
%table
  %tr
    %th Run variable
    %th Current value
    %th Created
    %th Updated
    %th at step
    %th at action
  - @vars.each do |var|
    %tr
      %td= var.name
      %td= var.value
      %td= my_datetime var.created_at
      %td= my_datetime var.updated_at
      %td= "s#{var.step.id} #{var.step.label}"  unless var.step.nil?
      %td= "a#{var.action.id}" unless var.action.nil?
%br

%h3 Actions
%table
  %tr
    %th Action
    %th Step
    %th Created
    %th Updated
    %th Completed
    %th Ret
    %th Output
  - @all_actions.each do |action|
    %tr
      %td= "a#{action.id}"
      %td.nowrap= "s#{action.step.id} #{action.step.label}" 
      %td= my_datetime action.created_at
      %td= my_datetime action.updated_at
      %td= my_datetime action.completed_at
      %td= action.retcode
      %td
        %small
          = action.output
%br


= link_to 'Edit', edit_run_path(@run)
\|
= link_to 'Back', runs_path
