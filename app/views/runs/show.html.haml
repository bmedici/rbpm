- map_class =  @run.completed_at.nil? ? 'autorefresh' : 'completed'
- status_label =  @run.completed_at.nil? ? 'running' : 'completed'
%p#notice= notice

%h3 Attributes
%p
  %b Start step:
  = @run.start_step_id
%p
  %b Created at:
  = @run.created_at
%p
  %b Updated at:
  = @run.updated_at
%p
  %b Completed at:
  = @run.completed_at
%br

%h3 Active actions
- if @running_actions.empty?
  No running action
  %br
- else
  %table
    %tr
      %th Action
      %th Step
      %th Created
      %th Updated
      %th Completed
    - @running_actions.each do |action|
      %tr
        %td= "a#{action.id}"
        %td= "s#{action.step.id} #{action.step.label}" 
        %td= my_datetime action.created_at
        %td= my_datetime action.updated_at
        %td= my_datetime action.completed_at
%br


%h3= "Status map for this run (#{status_label})"
= map_class
= image_tag run_graph_path, :class => map_class
%br

%h3 Actions
%table
  %tr
    %th Action
    %th Step
    %th Created
    %th Updated
    %th Completed
    %th RetCode
    %th Output
  - @all_actions.each do |action|
    %tr
      %td= "a#{action.id}"
      %td= "s#{action.step.id} #{action.step.label}" 
      %td= my_datetime action.created_at
      %td= my_datetime action.updated_at
      %td= my_datetime action.completed_at
      %td= action.retcode
      %td= action.output
%br

%h3 Variables
%table
  %tr
    %th Name
    %th Value
    %th Created
    %th Updated
    %th at step
    %th at action
  - @vars.each do |var|
    %tr
      %td= var.name
      %td= var.value
      %td= my_datetime var.created_at
      %td= my_datetime var.updated_at
      %td= "s#{var.step.id} #{var.step.label}" 
      %td= "a#{var.action.id}" 
%br


= link_to 'Edit', edit_run_path(@run)
\|
= link_to 'Back', runs_path
